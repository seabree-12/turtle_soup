# **海龟汤文字推理游戏插件 for ChatGPT-on-WeChat**

## 简介

**海龟汤文字推理游戏**（也叫水平思考游戏）是一款文字类推理游戏，玩家通过提问逐步揭开离奇故事的真相。这个插件将该游戏移植到 **ChatGPT-on-WeChat**，使玩家能够通过微信与 Bot 互动，回答问题并推理出故事的谜团。

通过该插件，用户可以与 Bot 一起玩"海龟汤"文字推理游戏，挑战自己的逻辑思维和推理能力。插件默认使用 **阿里灵积的 Dashscope** 提供的模型，但也支持通过配置选择使用 **OpenAI** 的模型。此外，插件还支持 **难度等级** 设置、**计分系统** 和 **自定义关键词**，使游戏更加灵活和有趣。

## 功能

- **随机故事**：每次游戏开始时，插件会从故事池中随机选择一个海龟汤情境。
- **智能问答**：用户可以向 Bot 提问，通过"是/否"的方式获取线索。
- **游戏结束与结果展示**：当用户推理出真相时，插件会提供谜题的完整答案和背景故事。
- **模型选择**：默认使用阿里灵积 Dashscope 的模型，支持通过配置切换为 OpenAI 的模型。
- **难度等级**：用户可以选择游戏的难度等级，影响谜题的复杂度。
- **计分系统**：系统会根据玩家的推理过程和完成时间给出分数。
- **自定义关键词**：用户可以自定义启动、结束和提示等关键词，方便个性化游戏体验。
- **自定义故事池**：用户可以添加、删除自己的故事，与默认故事池共同使用。

## 难度等级

插件提供四种难度等级，玩家可以在启动游戏时选择：

- **简单**：适合初学者，谜题较简单，推理线索明确。
- **中等**：适合有一定经验的玩家，谜题复杂度适中。
- **高等**：适合挑战性强的玩家，谜题的推理难度较大，需要细致的推理。
- **炼狱**：最难的难度，谜题极其复杂，需要玩家具备极高的推理能力和耐心。

### 如何选择难度

玩家在输入 **`开始汤`** 时，可以在后面附加难度等级，例如：

- **`开始汤 简单`**：启动简单难度的游戏。
- **`开始汤 中等`**：启动中等难度的游戏（默认）。
- **`开始汤 高等`**：启动高等难度的游戏。
- **`开始汤 炼狱`**：启动炼狱难度的游戏。

如果用��没有指定难度，默认选择 **中等** 难度。

### 配置难度等级

在 `config.py` 中，插件会根据难度等级调整谜题的复杂度。以下是配置式：

```python
# config.py

# 难度等级
# 简单：适合新手玩家
# 中等：适合有一定经验的玩家（默认）
# 高等：挑战性较大的谜题
# 炼狱：极具挑战性的谜题

DIFFICULTY_LEVEL = "medium"  # 可选值: "easy", "medium", "hard", "hell"
```

## 安装

### 前提条件

1. **Python 3.7+** 环境。
2. 已安装 **chatgpt-on-wechat** 插件框架，并且已配置好 ChatGPT 接入。
3. 已安装 `requests` 和 `openai` 等必需的 Python 库。

### 安装步骤

1. 克隆插件仓库：
   ```bash
   git clone https://github.com/yourusername/turtle-soup-chatgpt-wechat-plugin.git
   cd turtle-soup-chatgpt-wechat-plugin
   ```

2. 安装插件依赖：
   ```bash
   pip install -r requirements.txt
   ```

3. 配置 `config.py` 文件，填写阿里灵积 Dashscope 或 OpenAI API 密钥等相关信息。

4. 将插件文件放置在 `chatgpt-on-wechat` 插件目录下。

5. 启动插件服务：
   ```bash
   python plugin.py
   ```

## 配置

### 配置文件

插件的配置文件 `config.py` 用于设置游戏的基本参数、API 密钥、难度等级、计分规则和自定义关键词。你可以选择使用 **Dashscope** 模型或 **OpenAI** 的模型。

```python
# config.py

# API 密钥配置
dashscope_api_key = "your-dashscope-api-key"  # 阿里灵积 Dashscope API 密钥
open_ai_api_base = "your-openai-api-base"  # OpenAI API Base URL

# 游戏设置
STORY_POOL = "stories.json"  # 指定故事池文件

# 难度设置
DIFFICULTY_LEVEL = "medium"  # 可选值: "easy", "medium", "hard", "hell"（默认 "medium"）

# 计分设置
MAX_SCORE = 100  # 满分
PENALTY_PER_QUESTION = 2  # 每次提问的扣分
PENALTY_TIME_FACTOR = 0.5  # 每过一分钟扣除的分数

# 自定义关键词设置
START_KEYWORD = "开始汤"  # 游戏开始时的关键词
END_KEYWORD = "结束汤"  # 游戏结束时的关键词
TIP_KEYWORD = "提示"  # 提示关键词
```

### 自定义关键词

在 `config.py` 中，你可以修改以下关键词：

- **`START_KEYWORD`**：用来启动游戏的关键词。默认是 `"开始汤"`，你可以自定义为任何你喜欢的词语，例如 `"开始游戏"` 或 `"启动海龟汤"`。
  
- **`END_KEYWORD`**：用来结束游戏的关键词。默认是 `"结束汤"`，你可以自定义为 `"结束游戏"` 或其他词语。
  
- **`TIP_KEYWORD`**：用来请求提示的关键词。默认是 `"提示"`，你可以自定义为 `"给个提示"` 或其他任何词语。

### 模型选择与配置

插件会根据配置的 API 密钥自动选择使用的模型:

- 如果设置了 `dashscope_api_key`，将使用阿里灵积 Dashscope 模型
- 如果设置了 `open_ai_api_base`，将使用 OpenAI 模型
- 如果两者都设置了，优先使用 Dashscope 模型

#### Dashscope 配置

如果要使用 **Dashscope** 模型，只需要设置 `dashscope_api_key`：

```python
dashscope_api_key = "your-dashscope-api-key"
```

#### OpenAI 配置

如果要使用 **OpenAI** 模型，设置 `open_ai_api_base`：

```python
open_ai_api_base = "your-openai-api-base"
```

## 自定义故事池

插件支持用户添加自己的故事到游戏中。自定义故事会与默认故事池中的故事一起使用，让游戏更加丰富多样。

### 添加自定义故事

使用 `添加故事` 命令来添加新的故事，格式如下：

```
添加故事 难度 {
    "title": "故事标题",
    "situation": "初始情境描述",
    "truth": "故事真相",
    "background": "完整背景故事",
    "hints": ["提示1", "提示2", "提示3"]
}
```

例如：
```
添加故事 简单 {
    "title": "神秘的花",
    "situation": "一个人在房间里发现了一朵会说话的花",
    "truth": "那是一个会发声的玩具",
    "background": "这个人买了一个会发声的仿真花玩具，忘记了这件事",
    "hints": [
        "考虑现代科技",
        "想想玩具",
        "不是真花"
    ]
}
```

### 删除自定义故事

使用 `删除故事` 命令来删除已添加的自定义故事：

```
删除故事 故事ID
```

每个自定义故事都有一个唯一的ID（格式为 "custom_时间戳"），可以通过这个ID删除特定的故事。

### 故事格式说明

自定义故事需要包含以下字段：

- **title**: 故事的标题
- **situation**: 玩家看到的初始情境描述
- **truth**: 故事的真相
- **background**: 完整的背景故事
- **hints**: 提示数组，包含多个提示信息

### 故事难度

添加故事时可以指定难度级别：
- **简单**：适合新手的简单故事
- **中等**：需要一定推理能力的故事
- **高等**：较为复杂的故事
- **炼狱**：需要缜密推理的高难度故事

### 存储位置

自定义故事会保存在 `custom_stories.json` 文件中，与默认故事池 `stories.json` 分开存储。插件会��动加载两个故事池的内容。

### 注意事项

1. 添加故事时请确保 JSON 格式正确
2. 故事难度要与内容相匹配
3. 提示信息应该循序渐进，由浅入深
4. 每个故事都应该有明确的逻辑性
5. 删除故事操作不可撤销，请谨慎操作

### 示例故事

这里是一个好的自定义故事示例：

```json
{
    "title": "消失的钥匙",
    "situation": "一个人早上醒来发现放在床头柜上的钥匙不见了，房间的门窗都是锁着的。",
    "truth": "空调制冷时产生的冷凝水滴在钥匙上，钥匙顺着水滴滑落到了床头柜后面的缝隙中。",
    "background": "这是一个炎热的夏夜，房间开着空调睡觉。空调产生的冷凝水顺着墙面流下，正好滴在钥匙上。",
    "hints": [
        "关注房间的温度变化",
        "想想水从哪里来",
        "物体可能的运动方向"
    ]
}
```

这个故事展示了一个好的海龟汤故事应该具备的要素：
- 简洁的初始情境
- 符合逻辑的真相
- 完整的背景故事
- 递进式的提示信息

## 游戏流程

### 启动游戏

1. 用户发送配置的启动关键词（默认是 `开始汤`）来启动游戏。可以附加难度等级，例如：
   - `开始汤 简单`
   - `开始汤 中等`（默认）
   - `开始汤 高等`
   - `开始汤 炼狱`

2. 插件会根据配置的难度等级从故事池中选择一个适当难度的故事，并展示简短的情境描述。

### 提问与推理

1. 用户可以通过向 ChatGPT 提问来获取线索。所有问题必须是 **是/否** 类型的，例如：
   - "水是从杯子里洒出来的吗？"
   - "玻璃碎了是因为摔倒了吗？"

2. ChatGPT 会根据提供的故事背景和规则回答用户的问题。

3. 游戏中的每个问题都会扣除一定的分数，并且根据时间因素，玩家的分数会逐渐减少。

### 请求提示

1. 用户可以

通过发送 `提示`（或自定义的提示关键词）来请求帮助。
2. 插件会根据难度和故事的复杂度，提供一些提示。

### 推理出真相

当用户推理出真相时，插件会提供完整的谜题答案和背景故事。

### 游戏结束

1. 游戏可以通过发送 `结束汤`（或自定义的结束关键词）来结束。
2. 游戏结束时，系统会显示玩家的最终分数，并展示谜题的详细解答。

## 示例

- **开始游戏**：`开始汤 高等`
- **游戏进行中**：提问："是否有其他人在场？"
- **获取提示**：`提示`
- **结束游戏**：`结束汤`

---

希望这些修改能让你的游戏体验更加丰富！